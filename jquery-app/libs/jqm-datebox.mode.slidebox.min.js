/*
 * jQuery Mobile Framework : plugin to provide a date and time picker.
 * Copyright (c) JTSage
 * CC 3.0 Attribution.  May be relicensed without permission/notification.
 * https://github.com/jtsage/jquery-mobile-datebox
 */
(function(a){a.extend(a.mobile.datebox.prototype.options,{themeDateHigh:"e",themeDatePick:"a",themeDate:"d",useSetButton:true,validHours:false,slen:{y:5,m:6,d:15,h:12,i:30}});a.extend(a.mobile.datebox.prototype,{_sbox_pos:function(){var b=this,f,e,d,c;b.d.intHTML.find("div.ui-datebox-sliderow-int").each(function(){f=a(this);d=f.parent().innerWidth();if(b.__("isRTL")){e=f.find("div").last()}else{e=f.find("div").first()}c=f.find("div").size()*e.outerWidth();e.css("marginLeft",((c/2)-(d/2))*-1)})}});a.extend(a.mobile.datebox.prototype._build,{slidebox:function(){var n=this,c=this.options,e,k,p,d,f,m,g=this._makeDate(this.d.input.val()),h="ui-datebox-",j=a("<div class='"+h+"sliderow-int'></div>"),l=a("<div>"),b=a("<div>",{"class":h+"slide"});if(typeof n.d.intHTML!=="boolean"){n.d.intHTML.empty().remove()}n.d.input.on("datebox",function(o,i){if(i.method==="postrefresh"){n._sbox_pos()}});n.d.headerText=((n._grabLabel()!==false)?n._grabLabel():n.__("titleDateDialogLabel"));n.d.intHTML=a("<span>");n.fldOrder=n.__("slideFieldOrder");n._check();n._minStepFix();a('<div class="'+h+'header"><h4>'+n._formatter(n.__("headerFormat"),n.theDate)+"</h4></div>").appendTo(n.d.intHTML);n.d.intHTML.append(b);for(k=0;k<n.fldOrder.length;k++){d=l.clone().jqmData("rowtype",n.fldOrder[k]);p=j.clone().jqmData("rowtype",n.fldOrder[k]).appendTo(d);if(n.__("isRTL")===true){p.css("direction","rtl")}switch(n.fldOrder[k]){case"y":d.addClass(h+"sliderow-ym");for(e=c.slen.y*-1;e<(c.slen.y+1);e++){f=(e!==0)?((g.get(0)===(n.theDate.get(0)+e))?c.themeDateHigh:c.themeDate):c.themeDatePick;a("<div>",{"class":h+"slideyear ui-corner-all ui-btn-up-"+f}).html(n.theDate.get(0)+e).jqmData("offset",e).jqmData("theme",f).appendTo(p)}break;case"m":d.addClass(h+"sliderow-ym");for(e=c.slen.m*-1;e<(c.slen.m+1);e++){m=n.theDate.copy([0],[0,0,1]);m.adj(1,e);f=(e!==0)?((g.get(1)===m.get(1)&&g.get(0)===m.get(0))?c.themeDateHigh:c.themeDate):c.themeDatePick;a("<div>",{"class":h+"slidemonth ui-corner-all ui-btn-up-"+f}).html(String(n.__("monthsOfYearShort")[m.get(1)])).jqmData("offset",e).jqmData("theme",f).appendTo(p)}break;case"d":d.addClass(h+"sliderow-d");for(e=c.slen.d*-1;e<(c.slen.d+1);e++){m=n.theDate.copy();m.adj(2,e);f=(e!==0)?((g.comp()===m.comp())?c.themeDateHigh:c.themeDate):c.themeDatePick;if((c.blackDates!==false&&a.inArray(m.iso(),c.blackDates)>-1)||(c.blackDays!==false&&a.inArray(m.getDay(),c.blackDays)>-1)){f+=" "+h+"griddate-disable"}a("<div>",{"class":h+"slideday ui-corner-all ui-btn-up-"+f}).html(m.get(2)+'<br /><span class="'+h+'slidewday">'+n.__("daysOfWeekShort")[m.getDay()]+"</span>").jqmData("offset",e).jqmData("theme",f).appendTo(p)}break;case"h":d.addClass(h+"sliderow-hi");for(e=c.slen.h*-1;e<(c.slen.h+1);e++){m=n.theDate.copy();m.adj(3,e);f=(e!==0)?c.themeDate:c.themeDatePick;if(c.validHours!==false&&a.inArray(m.get(3),c.validHours)<0){f+=" "+h+"griddate-disable"}a("<div>",{"class":h+"slidehour ui-corner-all ui-btn-up-"+f}).html(n.__("timeFormat")===12?n._formatter('%I<span class="'+h+'slidewday">%p</span>',m):m.get(3)).jqmData("offset",e).jqmData("theme",f).appendTo(p)}break;case"i":d.addClass(h+"sliderow-hi");for(e=c.slen.i*-1;e<(c.slen.i+1);e++){m=n.theDate.copy();m.adj(4,(e*c.minuteStep));f=(e!==0)?c.themeDate:c.themeDatePick;a("<div>",{"class":h+"slidemins ui-corner-all ui-btn-up-"+f}).html(n._zPad(m.get(4))).jqmData("offset",e*c.minuteStep).jqmData("theme",f).appendTo(p)}break}d.appendTo(b)}if(c.useSetButton||c.useClearButton){k=a("<div>",{"class":h+"controls"});if(c.useSetButton){a('<a href="#">'+n.__("setDateButtonLabel")+"</a>").appendTo(k).buttonMarkup({theme:c.theme,icon:"check",iconpos:"left",corners:true,shadow:true}).on(c.clickEventAlt,function(i){i.preventDefault();if(n.dateOK===true){n.d.input.trigger("datebox",{method:"set",value:n._formatter(n.__fmt(),n.theDate),date:n.theDate});n.d.input.trigger("datebox",{method:"close"})}})}if(c.useClearButton){a('<a href="#">'+n.__("clearButton")+"</a>").appendTo(k).buttonMarkup({theme:c.theme,icon:"delete",iconpos:"left",corners:true,shadow:true}).on(c.clickEventAlt,function(i){i.preventDefault();n.d.input.val("");n.d.input.trigger("datebox",{method:"clear"});n.d.input.trigger("datebox",{method:"close"})})}if(c.useCollapsedBut){k.addClass("ui-datebox-collapse")}k.appendTo(n.d.intHTML)}if(n.wheelExists){n.d.intHTML.on("mousewheel",".ui-datebox-sliderow-int",function(i,o){i.preventDefault();n._offset(a(this).jqmData("rowtype"),((o<0)?-1:1)*(a(this).jqmData("rowtype")==="i"?c.minuteStep:1))})}n.d.intHTML.on(c.clickEvent,".ui-datebox-sliderow-int>div",function(i){i.preventDefault();n._offset(a(this).parent().jqmData("rowtype"),parseInt(a(this).jqmData("offset"),10))});n.d.intHTML.on("vmouseover vmouseout",".ui-datebox-sliderow-int>div",function(){n._hoover(this)});n.d.intHTML.on(n.drag.eStart,".ui-datebox-sliderow-int",function(i){if(!n.drag.move){n.drag.move=true;n.drag.target=a(this);n.drag.pos=parseInt(n.drag.target.css("marginLeft").replace(/px/i,""),10);n.drag.start=n.touch?i.originalEvent.changedTouches[0].pageX:i.pageX;n.drag.end=false;i.stopPropagation();i.preventDefault()}})}});a.extend(a.mobile.datebox.prototype._drag,{slidebox:function(){var b=this,d=this.options,c=this.drag;a(document).on(c.eMove,function(f){if(c.move&&d.mode==="slidebox"){c.end=b.touch?f.originalEvent.changedTouches[0].pageX:f.pageX;c.target.css("marginLeft",(c.pos+c.end-c.start)+"px");f.preventDefault();f.stopPropagation();return false}});a(document).on(c.eEnd,function(f){if(c.move&&d.mode==="slidebox"){c.move=false;if(c.end!==false){f.preventDefault();f.stopPropagation();c.tmp=c.target.find("div").first();b._offset(c.target.jqmData("rowtype"),(b.__("isRTL")?-1:1)*(parseInt((c.start-c.end)/c.tmp.innerWidth(),10))*(c.target.jqmData("rowtype")==="i"?d.minuteStep:1))}c.start=false;c.end=false}})}})})(jQuery);